# **SDK for Unity 5.6.x**

## **Table of Content**
* [**Tools**](#-Tools)
* [**Source Unity**](#Source-Unity)
* [**Setting**](#Setting)
* [**Android Plugin**](#Android-Plugin)
* [**AndroidManifest**](#AndroidManifest)
* [**Build Gradle**](#Build-Gradle)
* [**Q&A**](#Q&A)

### **Tools**

* [Unity **5.6.5p1**](https://unity3d.com/unity/qa/patch-releases/5.6.5p1)
* [Android Studio **3.5.x**](https://developer.android.com/studio)

### **Setting**

* Choose Minimum API Level: `Android 4.1 'Jelly Bean'`
* Choose Target API Level: `Automatic (highest installed)`

![](Identification.png)

### **Android Plugin**

Copy 4 files: [AndroidManifest.xml](./sdkdemo/Assets/Plugins/Android/AndroidManifest.xml), [mainTemplate.gradle](./sdkdemo/Assets/Plugins/Android/mainTemplate.gradle), [unity.aar](./sdkdemo/Assets/Plugins/Android/unity.aar), [VTCSdk.aar](./sdkdemo/Assets/Plugins/Android/VTCSdk.aar) into the `Assets/Plugin/Android` folder as the below image:

![](./plugin-android.png)

#### **AndroidManifest**

[AndroidManifest.xml](./sdkdemo/Assets/Plugins/Android/AndroidManifest.xml)

#### **Build Gradle**

Use the template to override gradle.build file generated by Unity.

[mainTemplate.gradle](./sdkdemo/Assets/Plugins/Android/mainTemplate.gradle)

Please without modify variables in the `**` symbols, else Unity will export the `build.gradle` file incorrect.

### **Source Unity**

Copy [SDKManager.cs](./sdkdemo/Assets/Scripts/SDKManager.cs) into the `Scripts` folder.

**Set enviroment**
```cs
SDKManager.SetEnviroment (SDKManager.ENVIRONMENT_SANDBOX);
```

**Init SDK**
```cs
#if UNITY_ANDROID
using (AndroidJavaClass unityPlayer = new AndroidJavaClass("com.unity3d.player.UnityPlayer")) {
    using (AndroidJavaObject activity = unityPlayer.GetStatic<AndroidJavaObject>("currentActivity")) {
        SDKManager.InitStartSDK (activity);
        SDKManager.SetClientId (<CLIENT_ID>);
        SDKManager.SetClientSecret (<CLIENT_SECRET>);
    }
}
#endif
```

**Implement IOnActivityResult to receive from VTCSdk**
```csharp
public class Main : MonoBehaviour, IOnActivityResult {
```

**SignIn**
```csharp
#if UNITY_ANDROID

public void onMessage(string message, int requestCode) {
    if (requestCode == SDKManager.SIGNIN_CODE) {
        Debug.Log("ACCOUNT NAME: " + SDKManager.vtcUser.accountName);
        Debug.Log("ACCOUNT ID: " + SDKManager.vtcUser.accountId);
        Debug.Log("VCOIN BALANCE: " + SDKManager.vtcUser.vcoinBalance);
    }
}

#endif

public void SignIn() {
    #if UNITY_ANDROID

    using (AndroidJavaClass unityPlayer = new AndroidJavaClass("com.unity3d.player.UnityPlayer")) {
        using (AndroidJavaObject activity = unityPlayer.GetStatic<AndroidJavaObject>("currentActivity")) {
            SDKManager.SignIn (activity, this);
        }
    }

    #endif
}
```

SignOut
```csharp
public void SignOut() {
    #if UNITY_ANDROID
    
    SDKManager.SignOut();		
    
    #endif
}
```

### **Q&A**

1. **Q:** Why need export to Android project?

    **A:** VTCSdk library need new version of gradle with more features than version 2.1.0 default of Unity.

2. **Q:** How to add new gradle version ?
    
    **A:** Link reference: https://docs.unity3d.com/560/Documentation/Manual/android-gradle-overview.html

3. **Q:** Why use gradle version `3.1.4`?
    
    **A:** Because it help avoid conflict with Android manifest file generated by the Unity 5.6.x.

4. **Q:** Why need use `unity.aar` with `VTCSdk.aar` together?
    
    **A:** `com.software.intecom.vtc.unity.UnityActivity` help the `unity.aar` library receive `onActivityResult` from `VTCSdk.aar` then send message to Unity. It don't require must extends or modify `UnityPlayerActivity` class.

    Note: Remember add declare the line `<activity android:name="com.software.intecom.vtc.unity.UnityActivity" android:theme="@android:style/Theme.Translucent.NoTitleBar"></activity>` in the `AndroidManifest.xml` file.

5. **Q:** Why need choose Target API Level is Automatic?

    **A:** Because the Unity 5.6.x only support max level is 25 (`Android 7.1 (API Level 25)`) to select, in while Google Play require must target at least [Android 9 (API level 28)](https://developer.android.com/distribute/best-practices/develop/target-sdk)
